<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div id="app">
        <p>name: <input type="text" v-model="name"></p>
        <!-- <p>username: <input type="text" v-model="username"></p>
        <p>password: <input type="password" v-model="password"></p> -->
        <div class="result">
            <p v-for="person in people">
                <input v-model="person.name">{{ person.name }}
                <button @click="deletePerson(person.id)">削除</button>
                <button @click="updatePerson(person.id, person.name)">変更</button>
            </p>
        </div>
        <button @click="create">add name</button>
        <button @click="show">show api</button>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        var app = new Vue({
                el: '#app',
                data: {
                    people:[],
                    name: ''
                },
                methods: {
                    create(){
                        axios({
                            url: "http://localhost:3000/person/create",
                            method: "post",
                            data: {
                                name: this.name
                            }
                        })
                        .then(response => {
                            console.log(response);
                            this.show()
                            this.name = ""
                        })
                        .catch(error => {
                            console.log(error);
                        });
                    },
                    show(){
                        axios({
                            url: "http://localhost:3000/person/",
                            method: "get"
                        })
                        .then(response => {
                            //① 取得に成功したら、この'response'に一覧が入っている！
                            console.log(response);
                            this.people = response.data
                            //② ①で取得したデータをpeopleに代入！
                        })
                    },
                    deletePerson(id){
                        axios({
                            url: `http://localhost:3000/person/${id}/`,
                            method: "delete"
                        })
                        .then(response => {
                            //① 取得に成功したら、この'response'に一覧が入っている！
                            console.log(response);
                            this.show()
                        })
                    },
                    updatePerson(id,name){
                        axios({
                            url: `http://localhost:3000/person/${id}/`,
                            method: "put",
                            data: {
                                name: name
                            }
                        })
                        .then(response => {
                            //① 取得に成功したら、この'response'に一覧が入っている！
                            console.log(response);
                            this.show()
                        })
                    }
                }
            })
    </script>
</body>
</html>